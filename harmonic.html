<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Function Plotter with Interactive Controls</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #f0f0f0, #c0c0c0);
        }
        .input-box {
            margin-bottom: 20px;
        }
        canvas {
            border: 1px solid #ccc;
        }
    </style>
    <script>
        function plotFunction() {
            const functionInput = document.getElementById('function-input').value;
            const xMin = parseFloat(document.getElementById('x-min').value);
            const xMax = parseFloat(document.getElementById('x-max').value);
            const yMin = parseFloat(document.getElementById('y-min').value);
            const yMax = parseFloat(document.getElementById('y-max').value);
            const canvas = document.getElementById('plot-canvas');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            ctx.clearRect(0, 0, width, height);

            let f;
            try {
                f = new Function('x', 'y', `with(Math){ return ${functionInput} }`);
                f(0, 0); // Test
            } catch (error) {
                alert('Invalid function input.');
                return;
            }

            // Determine z-min and z-max
            let zMin = Infinity, zMax = -Infinity;
            for (let px = 0; px < width; px++) {
                const x = xMin + (xMax - xMin) * px / width;
                for (let py = 0; py < height; py++) {
                    const y = yMin + (yMax - yMin) * (height - py) / height;
                    const z = f(x, y);
                    if (z < zMin) zMin = z;
                    if (z > zMax) zMax = z;
                }
            }

            const imageData = ctx.createImageData(width, height);
            const data = imageData.data;
            for (let px = 0; px < width; px++) {
                const x = xMin + (xMax - xMin) * px / width;
                for (let py = 0; py < height; py++) {
                    const y = yMin + (yMax - yMin) * (height - py) / height;
                    const z = f(x, y);
                    const ratio = (z - zMin) / (zMax - zMin || 1);
                    const color = Math.floor(255 * ratio);
                    const index = 4 * (py * width + px);
                    data[index + 0] = color; // R
                    data[index + 1] = 0;     // G
                    data[index + 2] = 255 - color; // B
                    data[index + 3] = 255;   // A
                }
            }
            ctx.putImageData(imageData, 0, 0);
        }

        function computeHarmoniticity() {
            const functionInput = document.getElementById('function-input').value;
            const xMin = parseFloat(document.getElementById('x-min').value);
            const xMax = parseFloat(document.getElementById('x-max').value);
            const yMin = parseFloat(document.getElementById('y-min').value);
            const yMax = parseFloat(document.getElementById('y-max').value);
            let f;
            try {
                f = new Function('x', 'y', `with(Math){ return ${functionInput} }`);
                f(0, 0); // Test
            } catch (error) {
                alert('Invalid function input for harmoniticity.');
                return;
            }
            const steps = 20; // Subgrid resolution
            const dx = (xMax - xMin) / steps;
            const dy = (yMax - yMin) / steps;
            const values = [];
            for (let i = 0; i <= steps; i++) {
                const row = [];
                const x = xMin + i * dx;
                for (let j = 0; j <= steps; j++) {
                    const y = yMin + j * dy;
                    row.push(f(x, y));
                }
                values.push(row);
            }
            let sumDiff = 0;
            let count = 0;
            for (let i = 1; i < steps; i++) {
                for (let j = 1; j < steps; j++) {
                    const val = values[i][j];
                    let neighborSum = 0;
                    for (let di = -1; di <= 1; di++) {
                        for (let dj = -1; dj <= 1; dj++) {
                            if (!(di === 0 && dj === 0)) {
                                neighborSum += values[i + di][j + dj];
                            }
                        }
                    }
                    const avgNeighbors = neighborSum / 8;
                    sumDiff += (val - avgNeighbors);
                    count++;
                }
            }
            const harmoniticity = sumDiff / count;
            alert(`Harmoniticity: ${harmoniticity}`);
        }
    </script>
</head>
<body>
    <div class="input-box">
        <label for="function-input">Enter function f(x, y): </label>
        <input type="text" id="function-input" value="x*x + y*y">
        <br>
        <label for="x-min">x-min: </label>
        <input type="number" id="x-min" value="-2">
        <label for="x-max">x-max: </label>
        <input type="number" id="x-max" value="2">
        <br>
        <label for="y-min">y-min: </label>
        <input type="number" id="y-min" value="-2">
        <label for="y-max">y-max: </label>
        <input type="number" id="y-max" value="2">
        <br>
        <button onclick="plotFunction()">Plot</button>
        <button onclick="computeHarmoniticity()">Compute Harmoniticity</button>
    </div>
    <canvas id="plot-canvas" width="800" height="600"></canvas>
</body>
</html>